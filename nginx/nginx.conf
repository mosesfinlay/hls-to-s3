user  root;
worker_processes auto;
error_log  /var/log/nginx/error.log warn;

events { worker_connections 1024; }

# === RTMP: enable MP4 recording ===
rtmp {
  server {
    listen 1935;
    listen [::]:1935 ipv6only=on;
    chunk_size 4096;

    application live {
      live on;

      # MP4 Recording  ❌
      # record all;
      # record_path /recordings;
      # record_suffix .mp4;
      # record_unique on;
      # record_append on;

      # FLV Recording ✅ (RTMP-native)
      record all;
      record_path /recordings/flv;
      record_suffix .flv;
      record_unique on;
      record_append on;
    }
  }
}

# === HTTP: simple health + local recordings browsing ===
http {
  include       mime.types;
  default_type  application/octet-stream;
  sendfile on;

  server {
    listen 80;
    server_name _;

    location / {
      return 200 'nginx-rtmp alive\n';
      add_header Content-Type text/plain;
    }

    location /recordings/ {
      types { video/mp4 mp4; video/x-flv flv; }
      alias /recordings/;
      add_header Cache-Control "no-store";
      autoindex on;
    }
  }
}
