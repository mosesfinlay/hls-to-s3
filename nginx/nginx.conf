worker_processes auto;
error_log  /var/log/nginx/error.log warn;

events { worker_connections 1024; }

# === RTMP: enable HLS output ===
rtmp {
  server {
    listen 1935;
    listen [::]:1935 ipv6only=on;
    chunk_size 4096;

    application live {
      live on;
      record off;

      # HLS
      hls on;
      hls_path /hls;
      hls_fragment 5s;           # adjust to taste
      hls_playlist_length 30s;   # ~6 segments at 5s
      hls_continuous on;
      hls_cleanup on;
      hls_nested on;             # /hls/<STREAM_KEY>/*
    }
  }
}

# === HTTP: simple health + local HLS browsing ===
http {
  include       mime.types;
  default_type  application/octet-stream;
  sendfile on;

  server {
    listen 80;
    server_name _;

    location / {
      return 200 'nginx-rtmp alive\n';
      add_header Content-Type text/plain;
    }

    location /hls/ {
      types { application/vnd.apple.mpegurl m3u8; video/mp2t ts; }
      alias /hls/;
      add_header Cache-Control "no-store";
      autoindex on;
    }
  }
}
