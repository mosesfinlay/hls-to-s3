worker_processes auto;
error_log  /var/log/nginx/error.log warn;

events { worker_connections 1024; }

# === RTMP: enable HLS output ===
rtmp {
  server {
    listen 1935;
    listen [::]:1935 ipv6only=on;
    chunk_size 4096;

    application live {
      live on;

      # Record MP4 files
      record all;
      record_path /hls;
      record_suffix .mp4;
      record_unique on;
      record_append on;
      record_duration ${RECORD_DURATION:-300s};  # Configurable duration per file
    }
  }
}

# === HTTP: simple health + local HLS browsing ===
http {
  include       mime.types;
  default_type  application/octet-stream;
  sendfile on;

  server {
    listen 80;
    server_name _;

    location / {
      return 200 'nginx-rtmp alive\n';
      add_header Content-Type text/plain;
    }

    location /hls/ {
      types { video/mp4 mp4; }
      alias /hls/;
      add_header Cache-Control "public, max-age=3600";
      autoindex on;
    }
  }
}
